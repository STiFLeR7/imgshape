{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://imgshape.ai/schemas/decision.v4.0.schema.json",
  "title": "Decision Object Schema",
  "description": "Deterministic decision object with full rationale in imgshape v4.0.0 (Atlas)",
  "type": "object",
  "required": [
    "decision_id",
    "selected",
    "why",
    "risks",
    "tradeoffs",
    "alternatives_considered"
  ],
  "properties": {
    "decision_id": {
      "type": "string",
      "description": "Unique identifier for this decision (e.g., model_family, resolution, augmentation)"
    },
    "selected": {
      "description": "The selected option/value",
      "oneOf": [
        {"type": "string"},
        {"type": "number"},
        {"type": "object"},
        {"type": "array"}
      ]
    },
    "why": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "minItems": 1,
      "description": "List of reasons explaining why this decision was made"
    },
    "risks": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["severity", "description"],
        "properties": {
          "severity": {
            "type": "string",
            "enum": ["low", "medium", "high", "critical"]
          },
          "description": {
            "type": "string"
          },
          "mitigation": {
            "type": "string",
            "description": "Suggested mitigation strategy"
          }
        }
      },
      "description": "Known risks associated with this decision"
    },
    "tradeoffs": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["aspect", "gain", "cost"],
        "properties": {
          "aspect": {
            "type": "string",
            "description": "What aspect is being traded (e.g., speed, accuracy, memory)"
          },
          "gain": {
            "type": "string",
            "description": "What is gained"
          },
          "cost": {
            "type": "string",
            "description": "What is sacrificed"
          }
        }
      },
      "description": "Tradeoffs made in this decision"
    },
    "alternatives_considered": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["option", "rejected_because"],
        "properties": {
          "option": {
            "description": "Alternative option that was considered",
            "oneOf": [
              {"type": "string"},
              {"type": "number"},
              {"type": "object"}
            ]
          },
          "rejected_because": {
            "type": "string",
            "description": "Reason why this alternative was not selected"
          }
        }
      },
      "minItems": 0,
      "description": "Other options that were considered but not selected"
    },
    "confidence": {
      "type": "number",
      "minimum": 0,
      "maximum": 1,
      "description": "Confidence in this decision"
    },
    "dependencies": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "description": "IDs of other decisions this one depends on"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "rule_version": {
          "type": "string",
          "description": "Version of the rule that produced this decision"
        },
        "fingerprint_inputs": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Which fingerprint profile fields influenced this decision"
        },
        "user_constraints": {
          "type": "object",
          "description": "User-provided constraints that influenced this decision"
        }
      }
    }
  }
}
